DROP DATABASE IF EXISTS SB_AM;
CREATE DATABASE SB_AM;
USE SB_AM;

CREATE TABLE `member` (
    id INT UNSIGNED PRIMARY KEY AUTO_INCREMENT,
    regDate DATETIME NOT NULL,
    updateDate DATETIME NOT NULL,
    loginId VARCHAR(50) NOT NULL UNIQUE,
    loginPw VARCHAR(100) NOT NULL,
    email VARCHAR(100) UNIQUE,
    is_spotify_connected BOOLEAN NOT NULL DEFAULT FALSE,
    spotify_profile_url TEXT,
    publicId VARCHAR(36) UNIQUE
);
UPDATE MEMBER SET publicId = UUID() WHERE publicId IS NULL;
ALTER TABLE `member` MODIFY publicId VARCHAR(36) NOT NULL UNIQUE;
ALTER TABLE `member` ADD COLUMN profileImage VARCHAR(255);

SELECT * FROM `member`;


CREATE TABLE user_album_rating (
  id INT UNSIGNED PRIMARY KEY AUTO_INCREMENT
  , regDate DATETIME NOT NULL DEFAULT NOW()
  , memberId INT UNSIGNED NOT NULL 
  , albumId VARCHAR(500) NOT NULL
  , rating DOUBLE NOT NULL
  , UNIQUE KEY uq_member_album (memberId, albumId)
  , FOREIGN KEY (memberId) REFERENCES `member`(id) ON DELETE CASCADE
);

SELECT * FROM user_album_rating;

CREATE TABLE want_album (
  id BIGINT PRIMARY KEY AUTO_INCREMENT,
  memberId BIGINT NOT NULL,
  albumId VARCHAR(100) NOT NULL,
  regDate DATETIME DEFAULT NOW(),
  UNIQUE KEY uq_member_album (memberId, albumId)
);

SELECT * FROM want_album;


